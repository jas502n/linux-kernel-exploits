http://legalhackers.com/exploits/tomcat-rootprivesc-deb.sh
#Apache Tomcat 8/7/6（基于Debian的Distros） - 特权升级
CVE： CVE-2016-1240
=============================================
- Discovered by: Dawid Golunski
- http://legalhackers.com
- dawid (at) legalhackers.com
 
- CVE-2016-1240
- Release date: 30.09.2016
- Revision: 1
- Severity: High
=============================================
 
 
I. VULNERABILITY
-------------------------
 
Apache Tomcat packaging on Debian-based distros - Local Root Privilege Escalation
 
Affected debian packages:
 
Tomcat 8 <= 8.0.36-2 
Tomcat 7 <= 7.0.70-2      
Tomcat 6 <= 6.0.45+dfsg-1~deb8u1
 
Ubuntu systems are also affected. See section VII. for details.
Other systems using the affected debian packages may also be affected.
 
 
II. BACKGROUND
-------------------------
 
"The Apache TomcatÂ® software is an open source implementation of the 
Java Servlet, JavaServer Pages, Java Expression Language and Java WebSocket 
technologies. The Java Servlet, JavaServer Pages, Java Expression Language 
and Java WebSocket specifications are developed under the Java Community 
Process.
 
The Apache Tomcat software is developed in an open and participatory 
environment and released under the Apache License version 2. 
The Apache Tomcat project is intended to be a collaboration of the 
best-of-breed developers from around the world.
 
Apache Tomcat software powers numerous large-scale, mission-critical web 
applications across a diverse range of industries and organizations. 
Some of these users and their stories are listed on the PoweredBy wiki page.
"
 
http://tomcat.apache.org/
 
 
III. INTRODUCTION
-------------------------
 
Tomcat (6, 7, 8) packages provided by default repositories on Debian-based 
distributions (including Debian, Ubuntu etc.) provide a vulnerable
tomcat init script that allows local attackers who have already gained access 
to the tomcat account (for example, by exploiting an RCE vulnerability
in a java web application hosted on Tomcat, uploading a webshell etc.) to
escalate their privileges from tomcat user to root and fully compromise the 
target system.
 
IV. DESCRIPTION
-------------------------
 
The vulnerability is located in the tomcat init script provided by affected
packages, normally installed at /etc/init.d/tomcatN. 
 
The script for tomcat7 contains the following lines:
 
-----[tomcat7]----
 
# Run the catalina.sh script as a daemon
set +e
touch "$CATALINA_PID" "$CATALINA_BASE"/logs/catalina.out
chown $TOMCAT7_USER "$CATALINA_PID" "$CATALINA_BASE"/logs/catalina.out
 
-------[eof]------
 
Local attackers who have gained access to the server in the context of the
tomcat user (for example, through a vulnerability in a web application) would 
be able to replace the log file with a symlink to an arbitrary system file 
and escalate their privileges to root once Tomcat init script (running as root)
re-opens the catalina.out file after a service restart, reboot etc.
 
As attackers would already have a tomcat account at the time of exploitation,
they could also kill the tomcat processes to introduce the need for a restart.
 
 
V. PROOF OF CONCEPT EXPLOIT
-------------------------
 
------[ tomcat-rootprivesc-deb.sh ]------
